<UserControl xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:VideoConversionApp.ViewModels"
  xmlns:converters="clr-namespace:VideoConversionApp.Converters"
  xmlns:views="clr-namespace:VideoConversionApp.Views"
  mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
  x:DataType="vm:RenderQueueViewModel"
  x:Class="VideoConversionApp.Views.RenderQueueView"
  AttachedToVisualTree="Visual_OnAttachedToVisualTree"
  Name="RenderQueueViewElement">

  <Design.DataContext>
    <vm:RenderQueueViewModel>
      <x:Arguments>
        <x:Null></x:Null>
        <x:Null></x:Null>
      </x:Arguments>
    </vm:RenderQueueViewModel>
  </Design.DataContext>
  
  <UserControl.Resources>
    <converters:DecimalToTimeStringConverter x:Key="DecimalToTimeStringConverter" />
    <converters:DateTimeAsLocalFormatConverter x:Key="DateTimeAsLocalFormatConverter" />
    <converters:BytesAsDataSizeStringConverter x:Key="BytesAsDataSizeStringConverter" />
    <converters:VideoOutputFilenameConverter x:Key="VideoOutputFilenameConverter"/>
    <converters:TimelineCropAsStringConverter x:Key="TimelineCropAsStringConverter" />
  </UserControl.Resources>

  <UserControl.Styles>
    <Style Selector="PathIcon.compact-render-successful">
      <Setter Property="Data" Value="{StaticResource checkmark_circle_regular}"></Setter>
      <Setter Property="Foreground" Value="Chartreuse"></Setter>
    </Style>
    <Style Selector="PathIcon.compact-render-failed">
      <Setter Property="Data" Value="{StaticResource error_circle_regular}"></Setter>
      <Setter Property="Foreground" Value="Firebrick"></Setter>
    </Style>
    <Style Selector="PathIcon.compact-rendering">
      <Setter Property="Data" Value="{StaticResource caret_right_regular}"></Setter>
      <Setter Property="Foreground" Value="DeepSkyBlue"></Setter>
    </Style>    
    <Style Selector="PathIcon.compact-queued">
      <Setter Property="Data" Value="{StaticResource keyboard_shift_uppercase_regular}"></Setter>
    </Style>   
  </UserControl.Styles>
  
  <DockPanel>
    <Border Classes="pane-heading" DockPanel.Dock="Top">
      <Panel>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
          <Border BorderThickness="0 0 1 0" BorderBrush="Gray" VerticalAlignment="Center">
            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0 0 12 0"
              FontSize="16" FontWeight="Bold">
              Render Queue
            </TextBlock>
          </Border>
          <Button Classes="basic-transparent" Command="{Binding ClearRenderQueueCommand}">
            <Button.Content>
              <StackPanel Orientation="Horizontal" Margin="8 0 0 0">
                <PathIcon Data="{StaticResource delete_regular}"></PathIcon>
                <TextBlock Margin="8">Clear queue</TextBlock>
              </StackPanel>
            </Button.Content>
          </Button>  
          <ToggleButton Classes="basic-transparent" IsChecked="{Binding ShowExpandedView}">
            <StackPanel Orientation="Horizontal" Margin="8 0 0 0">
              <PathIcon Data="{StaticResource text_expand_regular}"></PathIcon>
              <TextBlock Margin="8">Show expanded</TextBlock>
            </StackPanel>
          </ToggleButton>
        </StackPanel>
      </Panel>
    </Border>
    <Border Classes="pane-body pb-lb">
      <Grid ColumnDefinitions="*" RowDefinitions="*">

        <ListBox Name="RenderQueueListBox" ItemsSource="{Binding RenderQueue}" BorderBrush="Transparent">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Grid Name="ItemRoot" ColumnDefinitions="*" MaxWidth="{Binding $parent.Bounds.Width}">
                <Border CornerRadius="6" Margin="5" ClipToBounds="True" BorderThickness="1" BorderBrush="Black"
                  Background="#333333"
                  IsVisible="{Binding !$parent[ListBox].((vm:RenderQueueViewModel)DataContext).ShowExpandedView}">
                  <Grid ColumnDefinitions="Auto,Auto,*,Auto"  Margin="4" >
                    <PathIcon Grid.Column="0" Classes="compact-render-failed" Height="16" Margin="4 0 0 0"></PathIcon>
                    <TextBlock Grid.Column="1" Margin="0 0 8 0" Width="125" VerticalAlignment="Center" 
                      TextAlignment="Center" Text="{Binding Video.MediaInfo.Filename}" />
                    <Border Grid.Column="2" CornerRadius="20" ClipToBounds="True" Margin="0 0 6 0">
                      <ProgressBar Value="60" CornerRadius="0" Height="16" ShowProgressText="True" />
                    </Border>
                    <StackPanel Grid.Column="3" Orientation="Horizontal">
                      <StackPanel.Styles>
                        <Style Selector="Button">
                          <Setter Property="CornerRadius" Value="2"></Setter>
                          <Setter Property="Margin" Value="4"></Setter>
                          <Setter Property="BorderThickness" Value="0"></Setter>
                          <Setter Property="Height" Value="16"></Setter>
                          <Setter Property="Width" Value="16"></Setter>
                        </Style>
                        <Style Selector="Button:pointerover">
                          <Setter Property="Background" Value="#666666"></Setter>
                        </Style>
                        <Style Selector="Button PathIcon">
                          <Setter Property="Height" Value="10"></Setter>
                        </Style>
                      </StackPanel.Styles>
                      <Button
                        ToolTip.Tip="Retry rendering">
                        <PathIcon Data="{StaticResource arrow_redo_regular}"></PathIcon></Button>
                      <Button
                        ToolTip.Tip="Remove from queue" FontSize="8">
                        <PathIcon Data="{StaticResource dismiss_regular}"></PathIcon>
                      </Button>
                      <Button ToolTip.Tip="Move up in queue">
                        <PathIcon Data="{StaticResource arrow_up_regular}"></PathIcon>
                      </Button>
                      <Button ToolTip.Tip="Move down in queue">
                        <PathIcon Data="{StaticResource arrow_down_regular}"></PathIcon>
                      </Button>
                    </StackPanel>
                  </Grid>
                </Border>
                <Border CornerRadius="6" Margin="10" ClipToBounds="True" BorderThickness="1" BorderBrush="Black"
                  Background="#333333" IsVisible="{Binding $parent[ListBox].((vm:RenderQueueViewModel)DataContext).ShowExpandedView}">
                  <StackPanel Orientation="Vertical" Margin="8">
                    <Grid RowDefinitions="*" ColumnDefinitions="Auto,Auto,*,Auto" Height="80">
                      <Border Grid.Column="0" Grid.Row="0" CornerRadius="7" ClipToBounds="True" BorderBrush="Black"
                        BorderThickness="1">
                        <Border CornerRadius="7" ClipToBounds="True">
                          <Panel>
                            <Image Source="../Images/sample-thn-256.jpg" Stretch="UniformToFill"
                              RenderOptions.BitmapInterpolationMode="MediumQuality" />
                            <Ellipse Width="22" Height="22" Fill="#AA000000" VerticalAlignment="Top" HorizontalAlignment="Left"
                              Margin="2 2 0 0"  />
                            <PathIcon Classes="compact-rendering" Height="16" VerticalAlignment="Top" HorizontalAlignment="Left"
                              Margin="3 5 0 0"></PathIcon>
                          </Panel>
                        </Border>
                      </Border>

                      <Grid Grid.Column="1" RowDefinitions="2*,3*,3*,*,3*,3*,2*" Margin="10 0 0 0">
                        <TextBlock Grid.Column="0" Grid.Row="1" Text="{Binding Video.MediaInfo.Filename}"
                          TextTrimming="CharacterEllipsis" FontWeight="Bold"
                          Margin="0,0,6,0" HorizontalAlignment="Left" />
                        <TextBlock Grid.Column="0" Grid.Row="2" 
                          Text="{Binding Video.MediaInfo.DurationInSeconds, Converter={StaticResource DecimalToTimeStringConverter}}" 
                          TextTrimming="CharacterEllipsis"
                          Margin="0,0,6,0" HorizontalAlignment="Left" />
                        <TextBlock Grid.Column="0" Grid.Row="4" 
                          Text="{Binding Video.MediaInfo.CreatedDateTime, Converter={StaticResource DateTimeAsLocalFormatConverter}}"
                          TextTrimming="CharacterEllipsis"
                          Margin="0,0,6,0" HorizontalAlignment="Left" />
                        <TextBlock Grid.Column="0" Grid.Row="5" Text="{Binding Video.MediaInfo.SizeBytes, Converter={StaticResource BytesAsDataSizeStringConverter}}"
                          TextTrimming="CharacterEllipsis"
                          Margin="0,0,6,0" HorizontalAlignment="Left" />
                      </Grid>
                      
                      <Border Grid.Column="2" BorderBrush="#444444" BorderThickness="2 0 2 0" Margin="20 0 20 0">
                        <Grid RowDefinitions="2*,3*,3*,*,3*,3*,2*" ColumnDefinitions="Auto, *" Margin="10 0 0 0">
                          <Grid.Styles>
                            <Style Selector="TextBlock">
                              <Setter Property="Margin" Value="1 0 8 1"></Setter>
                            </Style>
                          </Grid.Styles>
                          <TextBlock Grid.Column="0" Grid.Row="1">Output to:</TextBlock>
                          <TextBlock Grid.Column="1" Grid.Row="1" 
                            Text="{Binding Video,
                            Converter={StaticResource VideoOutputFilenameConverter}, 
                            ConverterParameter={Binding $parent[ListBox].((vm:RenderQueueViewModel)DataContext).ConversionManager}}" /> <!-- converter:  to patterened filename-->
                          <TextBlock Grid.Column="0" Grid.Row="2">Orientation:</TextBlock>
                          <TextBlock Grid.Column="1" Grid.Row="2" Text="{Binding Video.FrameRotation}"></TextBlock>
                          <TextBlock Grid.Column="0" Grid.Row="4">Crop:</TextBlock>
                          <TextBlock Grid.Column="1" Grid.Row="4" 
                            Text="{Binding Video,
                            Converter={StaticResource TimelineCropAsStringConverter}, ConverterParameter=false}"></TextBlock>
                          <TextBlock Grid.Column="0" Grid.Row="5">Cropped duration:</TextBlock>
                          <TextBlock Grid.Column="1" Grid.Row="5" 
                            Text="{Binding Video,
                            Converter={StaticResource TimelineCropAsStringConverter}, ConverterParameter=true}"></TextBlock>
                        </Grid>
                      </Border>
                      
                      <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <StackPanel.Styles>
                          <Style Selector="Button">
                            <Setter Property="CornerRadius" Value="6"></Setter>
                            <Setter Property="Margin" Value="4"></Setter>
                            <Setter Property="BorderThickness" Value="0"></Setter>
                            <Setter Property="Height" Value="32"></Setter>
                            <Setter Property="Width" Value="32"></Setter>
                          </Style>
                          <Style Selector="Button:pointerover">
                            <Setter Property="Background" Value="#666666"></Setter>
                          </Style>
                          <Style Selector="Button PathIcon">
                            <Setter Property="Height" Value="16"></Setter>
                            <Setter Property="Width" Value="16"></Setter>
                          </Style>
                        </StackPanel.Styles>
                        <Button
                          ToolTip.Tip="Retry rendering">
                          <PathIcon Data="{StaticResource arrow_redo_regular}"></PathIcon></Button>
                        <Button
                          ToolTip.Tip="Remove from queue">
                          <PathIcon Data="{StaticResource dismiss_regular}"></PathIcon>
                        </Button>
                        <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                          <Button ToolTip.Tip="Move up in queue">
                            <PathIcon Data="{StaticResource arrow_up_regular}"></PathIcon>
                          </Button>
                          <Button ToolTip.Tip="Move down in queue">
                            <PathIcon Data="{StaticResource arrow_down_regular}"></PathIcon>
                          </Button>
                        </StackPanel>
                      </StackPanel>

                    </Grid>
                    <Border CornerRadius="6" ClipToBounds="True" Margin="0 10 0 0">
                      <ProgressBar Height="20" Value="34" ShowProgressText="True"></ProgressBar>
                      <!-- PROGRESS TEXT FORMAT https://docs.avaloniaui.net/docs/reference/controls/progressbar -->
                    </Border>
                    <Panel Name="ErrorHolderPanel" Margin="0 10 0 0" Width="{Binding $parent.Bounds.Width}"
                      IsVisible="false">
                      <Border Padding="10" Background="rgba(255,20,0,200)" CornerRadius="6" 
                        BorderThickness="2 0 2 0" BorderBrush="Red">
                        <Panel ClipToBounds="True">
                          <TextBlock TextWrapping="WrapWithOverflow" MaxWidth="{Binding #ErrorHolderPanel.Bounds.Width}" 
                            ClipToBounds="True" 
                            Text="Warning CS8604 : Possible null reference argument for parameter 'item' in 'int IListIImage.IndexOf(IImage item)' Warning CS8604 : Possible null reference argument for parameter 'item' in 'int IListIImage.IndexOf(IImage item)' Warning CS8604 : Possible null reference argument for parameter 'item' in 'int IListIImage.IndexOf(IImage item)'"></TextBlock>
                        </Panel>
                      </Border>
                    </Panel>
                  </StackPanel>

                </Border>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Grid>
    </Border>
  </DockPanel>

</UserControl>